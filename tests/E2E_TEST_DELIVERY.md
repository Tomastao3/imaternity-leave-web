# å‰ç«¯ Playwright E2E æµ‹è¯•äº¤ä»˜æ–‡æ¡£

> **é¡¹ç›®åç§°ï¼š** äº§å‡è®¡ç®—ç³»ç»Ÿå‰ç«¯E2Eæµ‹è¯•  
> **äº¤ä»˜æ—¥æœŸï¼š** 2025-10-22  
> **æµ‹è¯•æ¡†æ¶ï¼š** Playwright  
> **æµ‹è¯•æ¨¡å¼ï¼š** Page Objectæ¨¡å¼

---

## âœ… äº¤ä»˜æ¸…å•

### 1. æµ‹è¯•ä»£ç ï¼ˆ5ä¸ªæµ‹è¯•æ–‡ä»¶ï¼‰

| æ–‡ä»¶å | æµ‹è¯•åœºæ™¯ | æµ‹è¯•ç”¨ä¾‹æ•° | çŠ¶æ€ |
|--------|---------|-----------|------|
| `01-login.spec.js` | ç™»å½•/ç™»å‡ºã€æƒé™éªŒè¯ | 8ä¸ª | âœ… å®Œæˆ |
| `02-allowance-calculator.spec.js` | äº§å‡æ´¥è´´è®¡ç®—ã€å¤šåŸå¸‚è§„åˆ™ | 13ä¸ª | âœ… å®Œæˆ |
| `03-batch-processor.spec.js` | æ‰¹é‡å¤„ç†ã€Excelå¯¼å…¥å¯¼å‡º | 8ä¸ª | âœ… å®Œæˆ |
| `04-city-data-manager.spec.js` | æ•°æ®ç®¡ç†CRUDæ“ä½œ | 10ä¸ª | âœ… å®Œæˆ |
| `05-ai-chat.spec.js` | AIåŠ©æ‰‹é—®ç­”ï¼ˆå«Mockï¼‰ | 7ä¸ª | âœ… å®Œæˆ |
| **æ€»è®¡** | **5ä¸ªæ¨¡å—** | **46ä¸ªæµ‹è¯•ç”¨ä¾‹** | âœ… å®Œæˆ |

### 2. Page Objectç±»ï¼ˆ5ä¸ªï¼‰

| æ–‡ä»¶å | åŠŸèƒ½ | çŠ¶æ€ |
|--------|------|------|
| `LoginPage.js` | ç™»å½•é¡µé¢æ“ä½œå°è£… | âœ… å®Œæˆ |
| `AllowanceCalculatorPage.js` | äº§å‡æ´¥è´´è®¡ç®—å™¨æ“ä½œå°è£… | âœ… å®Œæˆ |
| `BatchProcessorPage.js` | æ‰¹é‡å¤„ç†æ“ä½œå°è£… | âœ… å®Œæˆ |
| `CityDataManagerPage.js` | æ•°æ®ç®¡ç†æ“ä½œå°è£… | âœ… å®Œæˆ |
| `AIChatPage.js` | AIåŠ©æ‰‹æ“ä½œå°è£… | âœ… å®Œæˆ |

### 3. æµ‹è¯•è¾…åŠ©å·¥å…·ï¼ˆ4ä¸ªï¼‰

| æ–‡ä»¶å | åŠŸèƒ½ | çŠ¶æ€ |
|--------|------|------|
| `auth.helper.js` | ç™»å½•/ç™»å‡ºè¾…åŠ©å‡½æ•° | âœ… å®Œæˆ |
| `form.helper.js` | è¡¨å•å¡«å†™è¾…åŠ©å‡½æ•° | âœ… å®Œæˆ |
| `assertion.helper.js` | æ–­è¨€è¾…åŠ©å‡½æ•° | âœ… å®Œæˆ |
| `file.helper.js` | æ–‡ä»¶æ“ä½œè¾…åŠ©å‡½æ•° | âœ… å®Œæˆ |

### 4. æµ‹è¯•æ•°æ®ï¼ˆ3ä¸ªï¼‰

| æ–‡ä»¶å | å†…å®¹ | çŠ¶æ€ |
|--------|------|------|
| `employees.json` | æµ‹è¯•å‘˜å·¥æ•°æ® | âœ… å®Œæˆ |
| `cityRules.json` | åŸå¸‚è§„åˆ™æµ‹è¯•æ•°æ® | âœ… å®Œæˆ |
| `batchSample.xlsx` | æ‰¹é‡å¤„ç†æµ‹è¯•Excel | âœ… å®Œæˆ |

### 5. æµ‹è¯•æ–‡æ¡£ï¼ˆ3ä¸ªï¼‰

| æ–‡ä»¶å | å†…å®¹ | çŠ¶æ€ |
|--------|------|------|
| `PLAYWRIGHT_GUIDE.md` | é›¶åŸºç¡€å¿«é€Ÿä¸Šæ‰‹æŒ‡å— | âœ… å®Œæˆ |
| `TEST_SCENARIOS.md` | æµ‹è¯•åœºæ™¯è¯¦ç»†è¯´æ˜ | âœ… å®Œæˆ |
| `README.md` | æµ‹è¯•ç›®å½•æ€»è§ˆ | âœ… å®Œæˆ |

### 6. é…ç½®æ›´æ–°

| æ–‡ä»¶å | æ›´æ–°å†…å®¹ | çŠ¶æ€ |
|--------|---------|------|
| `package.json` | æ·»åŠ æµ‹è¯•è„šæœ¬å‘½ä»¤ | âœ… å®Œæˆ |
| `playwright.config.js` | ä¼˜åŒ–æµ‹è¯•é…ç½® | âœ… å®Œæˆ |

---

## ğŸ¯ æµ‹è¯•è¦†ç›–è¯¦æƒ…

### åŠŸèƒ½è¦†ç›–

| åŠŸèƒ½æ¨¡å— | è¦†ç›–ç‡ | è¯´æ˜ |
|---------|-------|------|
| ç™»å½•/ç™»å‡º | 100% | åŒ…å«å‘˜å·¥å’ŒHRä¸¤ç§è§’è‰² |
| äº§å‡æ´¥è´´è®¡ç®— | 90%+ | æ ¸å¿ƒæµç¨‹100%ï¼ŒåŒ…å«å¤šåŸå¸‚è§„åˆ™ |
| æ‰¹é‡å¤„ç† | 85%+ | åŒ…å«ä¸Šä¼ ã€å¤„ç†ã€å¯¼å‡ºå…¨æµç¨‹ |
| æ•°æ®ç®¡ç† | 80%+ | åŒ…å«CRUDåŸºæœ¬æ“ä½œ |
| AIåŠ©æ‰‹ | 70%+ | åŒ…å«Mockæ¨¡å¼ |

### åŸå¸‚è§„åˆ™è¦†ç›–ï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰

1. âœ… **ä¸Šæµ·** - æ ‡å‡†è®¡ç®—å…¬å¼ï¼ˆæœ€å¸¸ç”¨ï¼‰
2. âœ… **æ·±åœ³** - æ ‡å‡†è®¡ç®—å…¬å¼ï¼ˆå¸¸ç”¨ï¼‰
3. âœ… **æˆéƒ½** - ç‰¹æ®Šå…¬å¼ `* 12 / 365`
4. âœ… **å¤©æ´¥** - ç‰¹æ®Šå…¬å¼ `/ 30.4`

### ç”¨æˆ·è§’è‰²è¦†ç›–

- âœ… **å‘˜å·¥è§’è‰²** - å—é™æƒé™ï¼ˆåªèƒ½è®¿é—®äº§å‡æ´¥è´´è®¡ç®—å’ŒAIåŠ©æ‰‹ï¼‰
- âœ… **HRè§’è‰²** - å®Œæ•´æƒé™ï¼ˆå¯è®¿é—®æ‰€æœ‰åŠŸèƒ½ï¼‰

---

## ğŸ› ï¸ æŠ€æœ¯å®ç°äº®ç‚¹

### 1. Page Objectæ¨¡å¼
- æé«˜ä»£ç å¤ç”¨æ€§
- é™ä½ç»´æŠ¤æˆæœ¬
- æµ‹è¯•ä»£ç æ›´æ¸…æ™°æ˜“è¯»

### 2. æµ‹è¯•æ•°æ®éš”ç¦»
- æ‰€æœ‰æµ‹è¯•æ•°æ®ä½¿ç”¨ `TEST_` å‰ç¼€
- ä¸ç”Ÿäº§æ•°æ®ä¸¥æ ¼åˆ†ç¦»
- æµ‹è¯•åè‡ªåŠ¨å›æ»š

### 3. AIæœåŠ¡Mock
- è‡ªåŠ¨æ£€æµ‹AIæœåŠ¡å¯ç”¨æ€§
- ä¸å¯ç”¨æ—¶è‡ªåŠ¨ä½¿ç”¨Mockæ¨¡å¼
- ä¸å½±å“æµ‹è¯•é€šè¿‡ç‡

### 4. å®Œå–„çš„é”™è¯¯å¤„ç†
- å¤„ç†å…ƒç´ æœªæ‰¾åˆ°æƒ…å†µ
- å¤„ç†è¶…æ—¶æƒ…å†µ
- å¤„ç†å¼‚æ­¥æ“ä½œ

### 5. è¯¦ç»†çš„æµ‹è¯•æŠ¥å‘Š
- HTMLæŠ¥å‘Šï¼ˆå¯è§†åŒ–ï¼‰
- JSONæŠ¥å‘Šï¼ˆCI/CDé›†æˆï¼‰
- å¤±è´¥æµ‹è¯•è‡ªåŠ¨æˆªå›¾å’Œå½•å±

---

## ğŸ“‹ å¿«é€Ÿå¼€å§‹æŒ‡å—

### ç¬¬ä¸€æ¬¡è¿è¡Œæµ‹è¯•

```bash
# 1. å®‰è£…ä¾èµ–
npm install

# 2. å®‰è£…Playwrightæµè§ˆå™¨
npx playwright install chromium

# 3. ç”Ÿæˆæµ‹è¯•é…ç½®æ•°æ®
npm run reset-config

# 4. è¿è¡Œæ‰€æœ‰E2Eæµ‹è¯•
npm run test:e2e

# 5. æŸ¥çœ‹æµ‹è¯•æŠ¥å‘Š
npm run test:report
```

### å¸¸ç”¨å‘½ä»¤

```bash
# è¿è¡Œæµ‹è¯•å¹¶æ˜¾ç¤ºæµè§ˆå™¨
npm run test:e2e:headed

# è°ƒè¯•æ¨¡å¼
npm run test:e2e:debug

# è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
npx playwright test tests/e2e/01-login.spec.js

# è¿è¡ŒåŒ…å«ç‰¹å®šå…³é”®è¯çš„æµ‹è¯•
npx playwright test --grep "ç™»å½•æˆåŠŸ"
```

---

## ğŸ“š æ–‡æ¡£è¯´æ˜

### 1. PLAYWRIGHT_GUIDE.md
**ç›®æ ‡è¯»è€…ï¼š** å®Œå…¨ä¸äº†è§£Playwrightçš„å¼€å‘äººå‘˜

**å†…å®¹åŒ…æ‹¬ï¼š**
- Playwrightæ˜¯ä»€ä¹ˆ
- ç¯å¢ƒå‡†å¤‡å’Œå®‰è£…æ­¥éª¤
- è¿è¡Œæµ‹è¯•çš„å„ç§æ–¹å¼
- æŸ¥çœ‹æµ‹è¯•æŠ¥å‘Š
- è°ƒè¯•æŠ€å·§
- ç¼–å†™æ–°æµ‹è¯•
- å¸¸è§é—®é¢˜è§£ç­”
- å¿«é€Ÿå‘½ä»¤å‚è€ƒ

### 2. TEST_SCENARIOS.md
**ç›®æ ‡è¯»è€…ï¼š** éœ€è¦äº†è§£æµ‹è¯•åœºæ™¯çš„å¼€å‘äººå‘˜å’Œæµ‹è¯•äººå‘˜

**å†…å®¹åŒ…æ‹¬ï¼š**
- æ¯ä¸ªæµ‹è¯•æ–‡ä»¶çš„è¯¦ç»†è¯´æ˜
- æ¯ä¸ªæµ‹è¯•åœºæ™¯çš„ä¸šåŠ¡èƒŒæ™¯
- æµ‹è¯•æ­¥éª¤å’ŒéªŒè¯ç‚¹
- æµ‹è¯•æ•°æ®è¯´æ˜
- å¦‚ä½•æ·»åŠ æ–°æµ‹è¯•

### 3. README.md
**ç›®æ ‡è¯»è€…ï¼š** æ‰€æœ‰é¡¹ç›®æˆå‘˜

**å†…å®¹åŒ…æ‹¬ï¼š**
- æµ‹è¯•ç›®å½•ç»“æ„
- å¿«é€Ÿå¼€å§‹
- æµ‹è¯•è¦†ç›–æƒ…å†µ
- å¸¸ç”¨å‘½ä»¤
- æ³¨æ„äº‹é¡¹

---

## âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹

### 1. æµ‹è¯•æ•°æ®ç®¡ç†

**åŸåˆ™ï¼š**
- âœ… æ‰€æœ‰æµ‹è¯•æ•°æ®ä»…å­˜æ”¾åœ¨ `tests/` ç›®å½•
- âœ… ä¸ä¿®æ”¹ `ConfigData/` ç›®å½•ï¼ˆç”Ÿäº§é…ç½®ï¼‰
- âœ… æµ‹è¯•æ•°æ®ä½¿ç”¨æ˜ç¡®çš„å‰ç¼€ï¼ˆ`TEST_`ï¼‰
- âœ… æµ‹è¯•åè‡ªåŠ¨å›æ»šæ•°æ®

**æµ‹è¯•æ•°æ®ä½ç½®ï¼š**
```
tests/fixtures/e2e/
â”œâ”€â”€ employees.json      # å‘˜å·¥æµ‹è¯•æ•°æ®
â”œâ”€â”€ cityRules.json      # åŸå¸‚è§„åˆ™æµ‹è¯•æ•°æ®
â””â”€â”€ batchSample.xlsx    # æ‰¹é‡å¤„ç†æµ‹è¯•Excel
```

### 2. AIæœåŠ¡å¤„ç†

**AIæœåŠ¡åœ°å€ï¼š** `http://127.0.0.1:8000/rag/ask`

**å¤„ç†ç­–ç•¥ï¼š**
- æµ‹è¯•å‰è‡ªåŠ¨æ£€æµ‹AIæœåŠ¡æ˜¯å¦å¯ç”¨
- å¦‚æœä¸å¯ç”¨ï¼Œè‡ªåŠ¨ä½¿ç”¨Mockæ¨¡å¼
- Mockæ¨¡å¼è¿”å›é¢„è®¾çš„æµ‹è¯•å›å¤
- ä¸å½±å“æµ‹è¯•é€šè¿‡ç‡

### 3. æ•°æ®åº“çŠ¶æ€å›æ»š

**å®ç°æ–¹å¼ï¼š**
- æµ‹è¯•æ•°æ®ä½¿ç”¨å”¯ä¸€æ ‡è¯†ï¼ˆ`TEST_` å‰ç¼€ï¼‰
- æµ‹è¯•åæŸ¥æ‰¾å¹¶åˆ é™¤æµ‹è¯•æ•°æ®
- ç¡®ä¿ä¸æ±¡æŸ“å®é™…æ•°æ®

**ç¤ºä¾‹ï¼š**
```javascript
// æ·»åŠ æµ‹è¯•æ•°æ®
await dataManagerPage.addRule({
  'åŸå¸‚': 'TEST_CITY_ä¸´æ—¶æµ‹è¯•',
  // ...
});

// æµ‹è¯•å®Œæˆååˆ é™¤
const testRowIndex = tableData.findIndex(row => row.includes('TEST_CITY'));
if (testRowIndex >= 0) {
  await dataManagerPage.deleteRow(testRowIndex);
}
```

### 4. å¹¶å‘æ‰§è¡Œ

**å½“å‰é…ç½®ï¼š** ä¸²è¡Œæ‰§è¡Œï¼ˆ`workers: 1`ï¼‰

**åŸå› ï¼š** é¿å…æ•°æ®å†²çª

**å¦‚éœ€å¹¶è¡Œï¼š**
- ç¡®ä¿æµ‹è¯•æ•°æ®å®Œå…¨ç‹¬ç«‹
- ä¿®æ”¹ `playwright.config.js` ä¸­çš„ `workers` é…ç½®

---

## ğŸ” æµ‹è¯•è´¨é‡ä¿è¯

### 1. æµ‹è¯•åŸåˆ™

- âœ… **ç‹¬ç«‹æ€§** - æ¯ä¸ªæµ‹è¯•ç‹¬ç«‹è¿è¡Œï¼Œä¸ä¾èµ–å…¶ä»–æµ‹è¯•
- âœ… **å¯é‡å¤æ€§** - æµ‹è¯•ç»“æœç¨³å®šå¯é‡å¤
- âœ… **æ¸…æ™°æ€§** - æµ‹è¯•æ„å›¾æ˜ç¡®ï¼Œæ˜“äºç†è§£
- âœ… **å¯ç»´æŠ¤æ€§** - ä½¿ç”¨Page Objectæ¨¡å¼ï¼Œä¾¿äºç»´æŠ¤

### 2. ä»£ç è´¨é‡

- âœ… ä½¿ç”¨è¯­ä¹‰åŒ–é€‰æ‹©å™¨ï¼ˆ`getByRole`ã€`getByLabel`ï¼‰
- âœ… é¿å…ç¡¬ç¼–ç ç­‰å¾…æ—¶é—´
- âœ… å®Œæ•´çš„é”™è¯¯å¤„ç†
- âœ… è¯¦ç»†çš„ä»£ç æ³¨é‡Š

### 3. æµ‹è¯•ç¨³å®šæ€§

- âœ… è‡ªåŠ¨ç­‰å¾…å…ƒç´ å‡ºç°
- âœ… å¤±è´¥é‡è¯•æœºåˆ¶ï¼ˆretries: 1ï¼‰
- âœ… è¶…æ—¶é…ç½®åˆç†
- âœ… é”™è¯¯æ—¶è‡ªåŠ¨æˆªå›¾å’Œå½•å±

---

## ğŸ“Š æµ‹è¯•æŠ¥å‘Šç¤ºä¾‹

### è¿è¡Œæµ‹è¯•

```bash
$ npm run test:e2e

Running 46 tests using 1 worker

  âœ“ 01-login.spec.js:8 tests (2m)
  âœ“ 02-allowance-calculator.spec.js:13 tests (5m)
  âœ“ 03-batch-processor.spec.js:8 tests (3m)
  âœ“ 04-city-data-manager.spec.js:10 tests (4m)
  âœ“ 05-ai-chat.spec.js:7 tests (2m)

  46 passed (16m)

To open last HTML report run:
  npx playwright show-report
```

### HTMLæŠ¥å‘Š

è¿è¡Œ `npm run test:report` æŸ¥çœ‹è¯¦ç»†çš„HTMLæŠ¥å‘Šï¼ŒåŒ…å«ï¼š
- æµ‹è¯•é€šè¿‡/å¤±è´¥ç»Ÿè®¡
- æ¯ä¸ªæµ‹è¯•çš„æ‰§è¡Œæ—¶é—´
- å¤±è´¥æµ‹è¯•çš„æˆªå›¾å’Œè§†é¢‘
- è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯

---

## ğŸš€ CI/CDé›†æˆå»ºè®®

### GitHub Actionsç¤ºä¾‹

```yaml
name: E2E Tests

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '18'
      - run: npm ci
      - run: npx playwright install --with-deps chromium
      - run: npm run reset-config
      - run: npm run test:e2e
      - uses: actions/upload-artifact@v3
        if: always()
        with:
          name: playwright-report
          path: test-results/
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### é‡åˆ°é—®é¢˜ï¼Ÿ

1. **æŸ¥çœ‹æ–‡æ¡£**
   - `tests/docs/PLAYWRIGHT_GUIDE.md` - å¿«é€Ÿä¸Šæ‰‹æŒ‡å—
   - `tests/docs/TEST_SCENARIOS.md` - æµ‹è¯•åœºæ™¯è¯´æ˜

2. **ä½¿ç”¨è°ƒè¯•æ¨¡å¼**
   ```bash
   npm run test:e2e:debug
   ```

3. **æŸ¥çœ‹å¤±è´¥æµ‹è¯•çš„æˆªå›¾å’Œè§†é¢‘**
   - ä½ç½®ï¼š`test-results/` ç›®å½•

4. **æŸ¥çœ‹Playwrightå®˜æ–¹æ–‡æ¡£**
   - https://playwright.dev/

5. **è”ç³»é¡¹ç›®ç»´æŠ¤äººå‘˜**

---

## âœ¨ æ€»ç»“

### å·²å®Œæˆçš„å·¥ä½œ

1. âœ… åˆ›å»ºäº†5ä¸ªå®Œæ•´çš„E2Eæµ‹è¯•æ–‡ä»¶ï¼Œå…±46ä¸ªæµ‹è¯•ç”¨ä¾‹
2. âœ… å®ç°äº†Page Objectæ¨¡å¼ï¼Œæé«˜ä»£ç å¤ç”¨æ€§
3. âœ… åˆ›å»ºäº†4ä¸ªæµ‹è¯•è¾…åŠ©å·¥å…·æ¨¡å—
4. âœ… å‡†å¤‡äº†å®Œæ•´çš„æµ‹è¯•æ•°æ®ï¼ˆJSON + Excelï¼‰
5. âœ… ç¼–å†™äº†3ä»½è¯¦ç»†çš„æµ‹è¯•æ–‡æ¡£
6. âœ… ä¼˜åŒ–äº†Playwrighté…ç½®
7. âœ… æ·»åŠ äº†ä¾¿æ·çš„npm scripts

### æµ‹è¯•ç‰¹ç‚¹

- âœ… **é›¶åŸºç¡€å¯ä¸Šæ‰‹** - è¯¦ç»†çš„æ–‡æ¡£å’Œç¤ºä¾‹
- âœ… **æ•°æ®å®Œå…¨éš”ç¦»** - ä¸æ±¡æŸ“å®é™…ç³»ç»Ÿ
- âœ… **è‡ªåŠ¨Mock AI** - AIæœåŠ¡ä¸å¯ç”¨æ—¶è‡ªåŠ¨Mock
- âœ… **å®Œå–„çš„æŠ¥å‘Š** - HTMLå¯è§†åŒ–æŠ¥å‘Š
- âœ… **æ˜“äºç»´æŠ¤** - Page Objectæ¨¡å¼
- âœ… **ç¨³å®šå¯é ** - å®Œå–„çš„é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶

### ä¸‹ä¸€æ­¥å»ºè®®

1. è¿è¡Œæµ‹è¯•éªŒè¯æ‰€æœ‰åŠŸèƒ½æ­£å¸¸
2. æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´æµ‹è¯•æ•°æ®
3. é›†æˆåˆ°CI/CDæµç¨‹
4. å®šæœŸè¿è¡Œæµ‹è¯•ç¡®ä¿åŠŸèƒ½ç¨³å®š
5. æ–°åŠŸèƒ½å¼€å‘æ—¶åŒæ­¥æ·»åŠ æµ‹è¯•

---

**äº¤ä»˜å®Œæˆï¼ç¥æ‚¨ä½¿ç”¨æ„‰å¿«ï¼** ğŸ‰

å¦‚æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·å‚è€ƒæ–‡æ¡£æˆ–è”ç³»é¡¹ç›®ç»´æŠ¤äººå‘˜ã€‚
