# 产假首月/结束月工资计算过程显示优化

## 🐛 问题描述

**症状**: 产假首月和结束月的计算过程显示在一行，不易阅读。

**用户反馈**:
```
计算过程：应发工资=员工基本工资（调整前）/工作日22天×出勤4天-个人部分社保公积金-工会费=20000.00/22*4=3636.36; 3636.36-4648.16-50.00=-1061.80

应该改为两行显示：
计算过程：应发工资=员工基本工资（调整前）/工作日22天×出勤4天=20000.00/22*4=3636.36;
          减扣后=应发工资-个人部分社保公积金-工会费=3636.36-4648.16-50.00=-1061.80
```

## 🔍 问题位置

**文件**: `src/utils/calculationFormatter.js`  
**函数**: `formatMonthWageProcess`  
**位置**: 第 49-79 行

**问题代码**:
```javascript
if (monthlySS > 0 || monthlyUnionFee > 0) {
  // 所有内容在一行
  process = `应发工资=...=3636.36; 3636.36-4648.16-50.00=-1061.80`;
}
```

## ✅ 解决方案

### 修改逻辑

将计算过程分成两行：
1. **第一行**: 计算应发工资
2. **第二行**: 计算减扣后金额（使用 `\n` 换行）

### 修改后的代码

```javascript
if (monthlySS > 0 || monthlyUnionFee > 0) {
  // 第一行：计算应发工资
  if (monthHolidayDays > 0) {
    process = `应发工资=${salaryLabel}/(工作日${monthWorkingDays}天+法定假日${monthHolidayDays}天)×出勤${actualWorkingDays}天=${formatCurrency(salaryUsed)}/(${monthWorkingDays}+${monthHolidayDays})*${actualWorkingDays}=${formatCurrency(baseWage)};`;
  } else {
    process = `应发工资=${salaryLabel}/工作日${monthWorkingDays}天×出勤${actualWorkingDays}天=${formatCurrency(salaryUsed)}/${monthWorkingDays}*${actualWorkingDays}=${formatCurrency(baseWage)};`;
  }
  
  // 第二行：计算减扣后金额
  process += `\n          减扣后=应发工资`;
  
  // 添加扣除项标签
  if (monthlySS > 0) {
    process += `-个人部分社保公积金`;
  }
  if (monthlyUnionFee > 0) {
    process += `-工会费`;
  }
  
  // 添加数值计算
  process += `=${formatCurrency(baseWage)}`;
  if (monthlySS > 0) {
    process += `-${formatCurrency(monthlySS)}`;
  }
  if (monthlyUnionFee > 0) {
    process += `-${formatCurrency(monthlyUnionFee)}`;
  }
  process += `=${formatCurrency(finalWage)}`;
}
```

### 关键点

1. **换行符**: 使用 `\n` 换行
2. **缩进**: 添加 10 个空格 `          ` 对齐第二行
3. **样式支持**: `themedProcessValueStyle` 已设置 `whiteSpace: 'pre-wrap'`，支持换行

## 🎯 修复效果

### 场景 1: 产假首月（无法定假日）

**修复前**:
```
计算过程：应发工资=员工基本工资（调整前）/工作日22天×出勤4天-个人部分社保公积金-工会费=20000.00/22*4=3636.36; 3636.36-4648.16-50.00=-1061.80
```

**修复后**:
```
计算过程：应发工资=员工基本工资（调整前）/工作日22天×出勤4天=20000.00/22*4=3636.36;
          减扣后=应发工资-个人部分社保公积金-工会费=3636.36-4648.16-50.00=-1061.80
```

### 场景 2: 产假结束月（有法定假日）

**修复前**:
```
计算过程：应发工资=员工基本工资（调整后）/(工作日18天+法定假日6天)×出勤8天-个人部分社保公积金-工会费=22000.00/(18+6)*8=7333.33; 7333.33-4748.16-50.00=2535.17
```

**修复后**:
```
计算过程：应发工资=员工基本工资（调整后）/(工作日18天+法定假日6天)×出勤8天=22000.00/(18+6)*8=7333.33;
          减扣后=应发工资-个人部分社保公积金-工会费=7333.33-4748.16-50.00=2535.17
```

### 场景 3: 只有社保公积金扣除（无工会费）

**修复前**:
```
计算过程：应发工资=员工基本工资/工作日22天×出勤4天-个人部分社保公积金=20000.00/22*4=3636.36; 3636.36-4648.16=-1011.80
```

**修复后**:
```
计算过程：应发工资=员工基本工资/工作日22天×出勤4天=20000.00/22*4=3636.36;
          减扣后=应发工资-个人部分社保公积金=3636.36-4648.16=-1011.80
```

### 场景 4: 无扣除项

**修复前 & 修复后**（保持不变）:
```
计算过程：应发工资=员工基本工资/工作日22天×出勤4天=20000.00/22*4=3636.36
```

**说明**: 无扣除项时不需要第二行，保持原样。

## 📊 显示逻辑

### 第一行：应发工资计算

```
应发工资 = 基本工资 / 工作日 × 出勤天数
         = 20000.00 / 22 * 4
         = 3636.36;
```

### 第二行：减扣后金额计算

```
减扣后 = 应发工资 - 个人部分社保公积金 - 工会费
       = 3636.36 - 4648.16 - 50.00
       = -1061.80
```

### 完整显示

```
计算过程：应发工资=员工基本工资（调整前）/工作日22天×出勤4天=20000.00/22*4=3636.36;
          减扣后=应发工资-个人部分社保公积金-工会费=3636.36-4648.16-50.00=-1061.80
```

## 🔗 相关显示位置

这个修改会影响以下两个位置：

### 1. 产假首月应发工资
- **位置**: "社保公积金减扣"卡片
- **显示**: 产假首月应发工资 + 计算过程
- **函数**: `formatStartMonthProcess`

### 2. 产假结束月应发工资
- **位置**: "社保公积金减扣"卡片
- **显示**: 产假结束月应发工资 + 计算过程
- **函数**: `formatEndMonthProcess`

两个函数都调用 `formatMonthWageProcess`，所以修改一处即可。

## 🧪 测试建议

### 测试场景 1: 产假首月（工资不够扣）
1. ✅ 设置产假开始日期：2025-11-25（月中开始）
2. ✅ 员工基本工资：20000.00
3. ✅ 月度社保公积金：4648.16
4. ✅ 工会费：50.00
5. ✅ 点击计算
6. ✅ 验证显示：
   - 第一行：应发工资计算
   - 第二行：减扣后金额（负数，红色）

### 测试场景 2: 产假结束月（工资够扣）
1. ✅ 设置产假结束日期：2026-02-20（月中结束）
2. ✅ 员工基本工资（调整后）：22000.00
3. ✅ 月度社保公积金：4748.16
4. ✅ 工会费：50.00
5. ✅ 点击计算
6. ✅ 验证显示：
   - 第一行：应发工资计算
   - 第二行：减扣后金额（正数，绿色）

### 测试场景 3: 有法定假日的月份
1. ✅ 设置产假期间包含春节等法定假日
2. ✅ 点击计算
3. ✅ 验证显示：
   - 第一行包含"(工作日X天+法定假日Y天)"

### 测试场景 4: 无扣除项
1. ✅ 不设置社保公积金和工会费
2. ✅ 点击计算
3. ✅ 验证显示：
   - 只有一行，显示应发工资计算

### 测试场景 5: 换行和对齐
1. ✅ 验证第二行正确换行
2. ✅ 验证第二行缩进对齐
3. ✅ 验证在不同浏览器中显示正常

## 📝 修改文件

- `src/utils/calculationFormatter.js`
  - 第 49-76 行：修改 `formatMonthWageProcess` 函数

## ✅ Clean Code 原则

- ✅ **可读性**: 
  - 分两行显示，逻辑更清晰
  - 第一行：计算基础工资
  - 第二行：计算扣除后金额

- ✅ **一致性**: 
  - 产假首月和结束月使用相同的格式
  - 与其他计算过程的显示风格一致

- ✅ **用户体验**: 
  - 更容易阅读和验证
  - 清楚地看到两个计算步骤

- ✅ **可维护性**: 
  - 逻辑清晰，易于修改
  - 注释明确标注两行的作用

## 🎉 总结

通过将计算过程分成两行显示，大大提高了可读性：

**第一行**: 清楚地显示如何计算应发工资  
**第二行**: 清楚地显示如何从应发工资中扣除社保公积金和工会费

这样用户可以：
1. ✅ 快速理解计算逻辑
2. ✅ 轻松验证每一步的计算
3. ✅ 清楚地看到扣除项的影响

特别是当工资不够扣时（负数），两行显示让用户更容易理解为什么会出现负数，以及需要返还多少。
